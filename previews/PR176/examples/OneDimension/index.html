<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>One-Dimensional Cases · OptimalTransport.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://juliaoptimaltransport.github.io/OptimalTransport.jl/examples/OneDimension/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><script src="../../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="OptimalTransport.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OptimalTransport.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>One-Dimensional Cases</a><ul class="internal"><li><a class="tocitem" href="#Packages"><span>Packages</span></a></li><li><a class="tocitem" href="#Continuous-Distribution"><span>Continuous Distribution</span></a></li><li><a class="tocitem" href="#Finite-Discrete-Distributions"><span>Finite Discrete Distributions</span></a></li></ul></li><li><a class="tocitem" href="../basic/">Basics</a></li><li><a class="tocitem" href="../empirical_sinkhorn_div/">Sinkhorn divergences</a></li><li><a class="tocitem" href="../nmf/">Wasserstein non-negative matrix factorisation</a></li><li><a class="tocitem" href="../variational/">Variational problems</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>One-Dimensional Cases</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>One-Dimensional Cases</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaOptimalTransport/OptimalTransport.jl/blob/master/examples/OneDimension/script.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="One-Dimensional-Cases"><a class="docs-heading-anchor" href="#One-Dimensional-Cases">One-Dimensional Cases</a><a id="One-Dimensional-Cases-1"></a><a class="docs-heading-anchor-permalink" href="#One-Dimensional-Cases" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/JuliaOptimalTransport/OptimalTransport.jl/blob/gh-pages/previews/PR176/examples/OneDimension.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p><em>You are seeing the HTML output generated by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a> from the <a href="https://github.com/JuliaOptimalTransport/OptimalTransport.jl/blob/master/examples/OneDimension/script.jl">Julia source file</a>. The corresponding notebook can be viewed in <a href="https://nbviewer.jupyter.org/github/JuliaOptimalTransport/OptimalTransport.jl/blob/gh-pages/previews/PR176/examples/OneDimension.ipynb">nbviewer</a>.</em></p><p>The 1D case in Optimal Transport is a special case where one can easily obtain closed form solutions efficiently when the cost function is convex. In this situation, one does no need to use Linear Programming solvers to obtain the exact solution to the problem.</p><h2 id="Packages"><a class="docs-heading-anchor" href="#Packages">Packages</a><a id="Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Packages" title="Permalink"></a></h2><p>We load the following packages into our environment:</p><pre><code class="language-julia hljs">using OptimalTransport
using Distances
using Distributions
using StatsPlots

using LinearAlgebra
using Random

Random.seed!(1234);</code></pre><h2 id="Continuous-Distribution"><a class="docs-heading-anchor" href="#Continuous-Distribution">Continuous Distribution</a><a id="Continuous-Distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-Distribution" title="Permalink"></a></h2><p>In the 1D case, when the source measure <span>$\mu$</span> is continuous and the cost function has the form <span>$c(x, y) = h(|x - y|)$</span> where <span>$h$</span> is a convex function, the optimal transport plan is the Monge map</p><p class="math-container">\[T = F_\nu^{-1} \circ F_\mu\]</p><p>where <span>$F_\mu$</span> is the cumulative distribution function of <code>μ</code> and <span>$F_\nu^{-1}$</span> is the quantile function of <code>ν</code>. In this setting, the optimal transport cost can be computed as</p><p class="math-container">\[\int_0^1 c(F_\mu^{-1}(x), F_\nu^{-1}(x)) \mathrm{d}x\]</p><p>where <span>$F_\mu^{-1}$</span> and <span>$F_\nu^{-1}$</span> are the quantile functions of <code>μ</code> and <code>ν</code>, respectively.</p><p>We start by defining the distributions.</p><pre><code class="language-julia hljs">μ = Normal(0, 1)

N = 10
ν = Poisson(N);</code></pre><p>Nest, we define a cost function.</p><pre><code class="language-julia hljs">c(x, y) = (abs(x - y))^2 # could have used `sqeuclidean` from `Distances.jl`

T = ot_plan(c, μ, ν);</code></pre><p><code>T</code> is the Monge Map. Let&#39;s visualize it.</p><pre><code class="language-julia hljs">p1 = plot(μ; label=&#39;μ&#39;)
p1 = plot!(ν; marker=:circle, label=&#39;ν&#39;)
p2 = plot(-2:0.1:2, T(-2:0.1:2); label=&quot;Monge map&quot;, color=:green, legend=:topleft)
plot(p1, p2)</code></pre><p><img src="../1455050697.svg" alt/></p><p>The optimal transport cost can be computed with</p><pre><code class="language-julia hljs">ot_cost(c, μ, ν)</code></pre><pre><code class="nohighlight hljs">104.72027014853339</code></pre><p>If instead you want the 2-Wasserstein distance (which is the square root of the optimal transport with the Square Euclidean distatce, then use</p><pre><code class="language-julia hljs">wasserstein(μ, ν; p=2)</code></pre><pre><code class="nohighlight hljs">10.233292243874079</code></pre><h2 id="Finite-Discrete-Distributions"><a class="docs-heading-anchor" href="#Finite-Discrete-Distributions">Finite Discrete Distributions</a><a id="Finite-Discrete-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-Discrete-Distributions" title="Permalink"></a></h2><p>If the source and target measures are 1D finite discrete distributions (sometimes referred as empirical distributions, or as sample distributions), and if the cost function is convex, then the optimal transport plan can be written as a sorting algorithm, where the utmost left probability mass of the source is transported to the closest probability mass of the target, until everything is transported.</p><p>Define your measures as DiscreteNonParametric, which is a type in Distributions.jl. Also, let&#39;s assume both point masses with equal weights and let&#39;s use the <code>sqeuclidean</code> function instead of creating our own cost function.</p><pre><code class="language-julia hljs">M = 15
μ = DiscreteNonParametric(1.5rand(M), fill(1 / M, M))

N = 10
ν = DiscreteNonParametric(1.5rand(N) .+ 2, fill(1 / N, N))

γ = ot_plan(sqeuclidean, μ, ν);</code></pre><p>This time γ is a sparse matrix containing the transport plan. Let&#39;s visualize the results. We create a function <code>curve</code> just as a helper to draw the transport plan.</p><pre><code class="language-julia hljs">function curve(x1, x2, y1, y2)
    a = min(y1, y2)
    b = (y1 - y2 + a * (x1^2 - x2^2)) / (x1 - x2)
    c = y1 + a * x1^2 - b * x1
    f(x) = -a * x^2 + b * x + c
    return f
end

p = plot(μ; marker=:circle, label=&#39;μ&#39;)
p = plot!(ν; marker=:circle, label=&#39;ν&#39;, ylims=(0, 0.2))
for i in 1:M, j in 1:N
    if γ[i, j] &gt; 0
        transport = curve(μ.support[i], ν.support[j], 1 / M, 1 / N)
        x = range(μ.support[i], ν.support[j]; length=100)
        p = plot!(x, transport.(x); color=:green, label=nothing, alpha=0.5)
    end
end
p</code></pre><p><img src="../2589081555.svg" alt/></p><p>Again, the optimal transport cost can be calculated with</p><pre><code class="language-julia hljs">ot_cost(sqeuclidean, μ, ν)</code></pre><pre><code class="nohighlight hljs">3.2925430197981305</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../basic/">Basics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Tuesday 2 May 2023 01:02">Tuesday 2 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
